<html>
  <head>
    <meta charset="utf-8" />
    <title>Date Picker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.2/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.2/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
  </head>
  <body>
    <div id="content"></div>
    <script type="text/babel">
      var monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
      ];
      var monthNamesShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul',
        'Aug', 'Sep', 'Oct', 'Nov', 'Dec'
      ];

      function daysInMonth(month, year) {
        return new Date(year, month, 0).getDate();
      } 

      var DateSelector = React.createClass({
        getInitialState: function() {
          var today = new Date();
          return {
            day: today.getDate(),
            month: today.getMonth(),
            year: today.getFullYear(),
            selectedView: "day"
          };
        },

        setSelectedView: function(view) {
          this.setState({"selectedView": view});
        },

        setSelectedDay: function(day) {
          this.setState({"day": day})
        },

        setSelectedMonth: function(month) {
          this.setState({"month": month})
        },

        setSelectedYear: function(year) {
          this.setState({"year": year})
        },

        render: function() {
          return (
            <div className="dateSelector">
              <SelectedDateHeader
                day={this.state.day}
                month={this.state.month}
                year={this.state.year}
                setSelectedView={this.setSelectedView}
              />
              {
                this.state.selectedView === "day" ?
                  <DaySelector
                    setSelectedDay={this.setSelectedDay}
                    day={this.state.day}
                    month={this.state.month}
                    year={this.state.year}
                  /> : null
              }
              {
                this.state.selectedView === "month" ?
                  <MonthSelector
                    month={this.state.month}
                    setSelectedMonth={this.setSelectedMonth}
                  /> : null
              }
              {
                this.state.selectedView === "year" ?
                  <YearSelector 
                    year={this.state.year}
                    setSelectedYear={this.setSelectedYear}
                  /> : null
              }
            </div>
          );
        }
      });

      var SelectedDateHeader = React.createClass({
        handleDayClick: function(){
          this.props.setSelectedView("day");
        },

        handleMonthClick: function(){
          this.props.setSelectedView("month");
        },

        handleYearClick: function(){
          this.props.setSelectedView("year");
        },

        render: function() {
          return (
            <div className="selectedDateHeader">
              <div onClick={this.handleDayClick}>
                {this.props.day}
              </div>
              <div onClick={this.handleMonthClick}>
                {monthNames[this.props.month]}
              </div>
              <div onClick={this.handleYearClick}>
                {this.props.year}
              </div>
            </div>
          );
        }
      });

      var DayLabel = React.createClass({
        setSelectedDay: function() {
          this.props.setSelectedDay(this.props.day)
        },

        render: function() {
          return (
            <div onClick={this.setSelectedDay}> {this.props.selected ? "selected" : null} {this.props.day}</div>
          )
        }
      })

      var DaySelector = React.createClass({
        render: function() {
          var days = []
          for (var i=1; i<daysInMonth(this.props.month + 1, this.props.year) + 1; i++){
            days.push(
              <DayLabel
                day={i}
                selected={this.props.day == i}
                setSelectedDay={this.props.setSelectedDay}
                key={i}
              />
            )
          }
          return (
            <div>
              <div> === Day === </div>
              {days}
            </div>
          );
        }
      });

      var MonthLabel = React.createClass({
        setSelectedMonth: function() {
          this.props.setSelectedMonth(this.props.month)
        },

        render: function() {
          return (
            <div onClick={this.setSelectedMonth}> {this.props.selected ? "selected" : null} {monthNamesShort[this.props.month]}</div>
          )
        }
      })

      var MonthSelector = React.createClass({
        render: function() {
          var months = []
          for (var i=0; i<monthNamesShort.length; i++){
            months.push(
              <MonthLabel month={i} key={i} selected={i==this.props.month} setSelectedMonth={this.props.setSelectedMonth}/>
            );
          }
          return (
            <div>
              <div> === Month === </div>
              {months}
            </div>
          );
        }
      });

      var YearLabel = React.createClass({
        setSelectedYear: function() {
          this.props.setSelectedYear(this.props.year)
        },

        render: function() {
          return (
            <div onClick={this.setSelectedYear}> {this.props.selected ? "selected" : null} {this.props.year}</div>
          )
        }
      })

      var YearSelector = React.createClass({
        render: function() {
          var years = []
          var yearsOnPage = 10;
          var startYear = Math.floor(this.props.year / yearsOnPage) * yearsOnPage;
          for (var i=startYear; i < startYear + yearsOnPage; i++){
            years.push(
              <YearLabel year={i} key={i} selected={i==this.props.year} setSelectedYear={this.props.setSelectedYear}/>
            )
          }
          return (
            <div>
              <div> === Year === </div>
              {years}
            </div>
          );
        }
      });

      ReactDOM.render(
        <DateSelector />,
        document.getElementById('content')
      );
    </script>
  </body>
</html>
